# L-System Tree Generator (OpenGL 3.3 • C++17)

This project procedurally generates **3D tree meshes** using an **L-system + turtle interpreter** and renders them with **tangent-space normal mapping** (albedo/normal/roughness). It includes two presets (**Deciduous** and **Conifer**) and an optional **environment mode** (`-e`) that draws an **HDRI equirectangular background** plus a textured **hill/ground** mesh with a **circular alpha fade** so plane edges disappear.

---

## Build & Run (Visual Studio 2019, Windows)

Open **"x64 Native Tools Command Prompt for VS 2019"** in the project root (the folder containing `CMakeLists.txt`).

```bat
cmake -S . -B build -G "Visual Studio 16 2019" -A x64
cmake --build build --config Debug
./build/Debug/opengl-template.exe -h
```

Notes:
- If you change `CMakeLists.txt` or add/remove source files, rerun the first CMake command.
- The `build/` folder is generated by CMake.

---

## Running (CLI flags)

The program supports:

- `-d`, `--deciduous` — Deciduous preset (**default**)
- `-c`, `--conifer` — Conifer preset
- `-e`, `--environment` — Enable HDRI background + hill/ground
- `-s`, `--solid` — Solid light-gray bark (useful for clean screenshots)
- `-i <n>` — L-system iteration count
- `-seed <n>`, `--seed <n>` — Random seed (repeatable generation)
- `-h`, `--help` — Print help

Examples:

```bat
# Default deciduous tree
./build/Debug/opengl-template.exe -d -i 15 -seed 2025

# Conifer tree
./build/Debug/opengl-template.exe -c -i 15 -seed 12345

# Environment mode (HDRI + ground)
./build/Debug/opengl-template.exe -d -e -i 15

# Solid bark (no bark textures; still supports environment mode)
./build/Debug/opengl-template.exe -c -e -s -i 15
```

Controls:
- `ESC` closes the window.

---

## Repository layout (relevant folders)

```text
.
├─ CMakeLists.txt
├─ cmake/
├─ source/
│  ├─ main.cpp
│  ├─ TreeGen.h
│  ├─ TreeGen.cpp
│  ├─ LSystem.h
│  └─ LSystem.cpp
└─ assets/
   ├─ HDRIs/
   ├─ ground/
   └─ textures/
```

---

## Assets layout (expected by the code)

The program searches upward from the current working directory for `assets/textures` to locate the project root.

### Bark textures

Bark textures are stored inside folders with a `.blend` suffix (they are treated as directories by the loader):

```text
assets/textures/
├─ bark_brown_02_1k.blend/
│  ├─ bark_brown_02_diff_1k.png
│  ├─ bark_brown_02_nor_gl_1k.png
│  └─ bark_brown_02_rough_1k.png
└─ pine_bark_1k.blend/
   ├─ pine_bark_diff_1k.png
   ├─ pine_bark_nor_gl_1k.png
   └─ pine_bark_rough_1k.png
```

### Ground textures (environment mode only)

```text
assets/ground/
├─ deciduous/
│  ├─ red_laterite_soil_stones_diff_1k.png
│  ├─ red_laterite_soil_stones_nor_gl_1k.png
│  └─ red_laterite_soil_stones_rough_1k.png
└─ conifer/
   ├─ forrest_ground_01_diff_1k.png
   ├─ forrest_ground_01_nor_gl_1k.png
   └─ forrest_ground_01_rough_1k.png
```

### HDRIs (environment mode only)

```text
assets/HDRIs/
├─ deciduous/
│  └─ belfast_sunset_2k.png
└─ conifer/
   └─ autumn_park_2k.png
```

If you replace textures, keep filenames the same (or update the paths in `source/main.cpp`).

---

## What’s implemented

### Tree generation
- L-system sentence generation with **stochastic** rewrite rules.
- Turtle interpretation into a single triangle mesh.
- Branch/trunk geometry generated as **frustum segments**.
- Per-vertex **normals + tangents** for tangent-space normal mapping.
- Reproducible generation via `-seed`.
- Two presets: **Deciduous** and **Conifer**.

### Rendering
- OpenGL 3.3 core, GLFW + GLAD + GLM.
- Material shader supports:
  - albedo + normal + roughness maps
  - macro noise + UV warp (bark breakup)
  - optional anti-tiling blend (ground)
  - circular ground alpha mask

### Environment mode (`-e`)
- Equirectangular HDRI background drawn as a full-screen triangle.
- Textured hill/ground with circular fade.
- Two-pass hill render:
  - depth prepass (alpha cutout) so the hill can occlude the trunk
  - blended color pass for the soft fade edge

---

## Code map

- `source/main.cpp`: CLI parsing, texture loading (stb_image), shaders, HDRI background pass, hill passes, tree draw.
- `source/TreeGen.cpp` / `source/TreeGen.h`: preset grammars, turtle interpreter, mesh generation.
- `source/LSystem.cpp` / `source/LSystem.h`: L-system engine (rules + probabilistic rewriting).

---

## Known limitations

- No foliage/leaf geometry (branches only).
- Very high iteration counts can produce extremely long sentences and large meshes.
- Texture paths are currently hard-coded (see `source/main.cpp`).

---

## Credits

Texture and HDRI sources: see `assets/texture_sources.md`.

